{% load static %}
<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | BudgetBuddy</title>
  <link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif;}
    body {background:#f7f9fc; color:#2c3e50;}
    a {text-decoration:none; color:inherit;}

    :root {
      --primary:#2c3e50;
      --secondary:#f39c12;
      --light:#ffffff;
      --gray:#7f8c8d;
      --soft:#eef2f7;
    }

    
    header {
      position:fixed; top:0; left:0; width:100%; z-index:1000;
      background:rgba(255,255,255,0.95);
      padding:1rem 8%; display:flex; justify-content:space-between; align-items:center;
      box-shadow:0 4px 20px rgba(0,0,0,0.05);
      backdrop-filter: blur(10px);
    }
    header .logo {
      font-size:1.6rem; font-weight:700; color:var(--primary);
      display:flex; align-items:center; gap:0.5rem;
    }
    header nav {display:flex; gap:1.5rem;}
    header nav a {font-weight:500; color:var(--primary); transition:0.3s;}
    header nav a:hover {color:var(--secondary);}

    
    .page-intro {
      margin-top:6rem;
      text-align:center;
      padding:2rem 1rem;
    }
    .page-intro h2 {font-size:2rem; color:var(--primary); margin-bottom:0.5rem;}
    .page-intro p {color:var(--gray); font-size:1.1rem;}

    
    .container {
      padding:2rem 8%;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
      gap:1.5rem;
    }

    
    .card {
      background:var(--light);
      padding:1.5rem;
      border-radius:15px;
      box-shadow:0 6px 20px rgba(0,0,0,0.06);
      transition:0.3s;
    }
    .card:hover {transform:translateY(-4px);}
    .card h3 {
      margin-bottom:1rem;
      color:var(--primary);
      font-size:1.2rem;
      border-left:4px solid var(--secondary);
      padding-left:0.5rem;
    }
    .btn {
      background:var(--secondary); color:#fff;
      border:none; padding:0.6rem 1.4rem;
      border-radius:25px; cursor:pointer; transition:0.3s;
      font-weight:500;
    }
    .btn:hover {background:#d68910;}
    .input-group {margin-bottom:1rem;}
    .input-group label {display:block; margin-bottom:0.4rem; color:var(--primary);}
    .input-group input, .input-group select {
      width:100%; padding:0.6rem; border:1px solid #ddd;
      border-radius:8px; font-size:1rem; background:#fafbfc;
    }
    .card p {margin:0.3rem 0; font-size:0.95rem;}

    
    .history-card {text-align:center; background:#fefefe;}

    
    .graphs {
      padding:3rem 8%;
    }
    .graphs h2 {
      text-align:center;
      margin-bottom:2rem;
      font-size:1.8rem;
      color:var(--primary);
    }
    .graph-container {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
      gap:2rem;
    }
    .graph-box {
      background:#fff;
      padding:1.5rem;
      border-radius:15px;
      box-shadow:0 6px 20px rgba(0,0,0,0.06);
    }
  </style>
</head>
<body>


<header>
  <a href="{% url 'home' %}" class="logo"><i class='bx bx-wallet'></i> BudgetBuddy</a>
  <nav>
    <a href="{% url 'home' %}">Početna</a>
    <a href="{% url 'logout' %}">Odjava</a>
  </nav>
</header>


<section class="page-intro">
  <h2>BudgetBuddy</h2>
  <p>Pregledaj prihode, troškove i postavi svoje ciljeve za financijsku slobodu.</p>
</section>


<div class="container">
  
  <div class="card">
    <h3>Odaberi mjesec i godinu</h3>
    <form method="get">
      <div class="input-group">
        <label for="month">Mjesec i godina:</label>
        <input type="month" id="month" name="month" value="{{ selected_month }}">
      </div>
      <button type="submit" class="btn">Otvori</button>
    </form>
  </div>

  
  <div class="card">
    <h3>Moj mjesečni cilj</h3>
    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="action" value="cilj">
      <input type="hidden" name="month" value="{{ selected_month }}">
      <div class="input-group">
        <label for="cilj">Unesi cilj (EUR):</label>
        <input type="number" name="cilj" placeholder="npr. 300">
      </div>
      <button class="btn" type="submit">Spremi cilj</button>
    </form>
    <p><b>Trenutni cilj:</b> {{ monthly_data.goal }} EUR</p>
  </div>

  
  <div class="card">
    <h3>Unesi prihode</h3>
    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="action" value="prihodi">
      <input type="hidden" name="month" value="{{ selected_month }}">
      <div class="input-group">
        <label for="prihodi">Prihodi (EUR):</label>
        <input type="number" name="prihodi" placeholder="npr. 1000">
      </div>
      <button class="btn" type="submit">Spremi prihode</button>
    </form>
    <p><b>Ukupni prihodi do sada:</b> {{ monthly_data.income }} EUR</p>
  </div>

  
  <div class="card">
    <h3>Dodaj trošak</h3>
    <form method="POST">
      {% csrf_token %}
      <input type="hidden" name="action" value="trosak">
      <input type="hidden" name="month" value="{{ selected_month }}">
      <div class="input-group">
        <label for="kategorija">Kategorija:</label>
        <select name="kategorija" id="kategorija">
          <option value="hrana">Hrana</option>
          <option value="smjestaj">Smještaj</option>
          <option value="prijevoz">Prijevoz</option>
          <option value="zabava">Zabava</option>
          <option value="ostalo">Ostalo</option>
          <option value="custom">Dodaj novu kategoriju</option>
        </select>
      </div>
      <div class="input-group" id="custom-category" style="display:none;">
        <label for="nova_kategorija">Nova kategorija:</label>
        <input type="text" name="nova_kategorija" placeholder="npr. Kava">
      </div>
      <div class="input-group">
        <label for="iznos">Iznos (EUR):</label>
        <input type="number" name="iznos" placeholder="npr. 50">
      </div>
      <button class="btn" type="submit">Dodaj trošak</button>
    </form>
  </div>

  
  <div class="card">
    <h3>Trenutno stanje</h3>
    <p><b>Ukupni prihodi:</b> {{ monthly_data.income }} EUR</p>
    <p><b>Ukupni troškovi:</b> {{ total_expenses }} EUR</p>
    <p><b>Preostalo sredstava:</b> {{ remaining }} EUR</p>
  </div>

  
  <div class="card history-card">
    <h3>Povijest financija</h3>
    <p>Pregledaj i usporedi mjesečne rezultate</p>
    <a href="{% url 'history' %}"><button class="btn">Pogledaj povijest</button></a>
  </div>
</div>


<section class="graphs">
  <h2>Financijski grafovi</h2>
  <div class="graph-container">
    <div class="graph-box">
      <h3>Potrošnja po kategorijama</h3>
      <canvas id="expensesChart"></canvas>
    </div>
    <div class="graph-box">
      <h3>Prihodi vs. Troškovi</h3>
      <canvas id="incomeExpenseChart"></canvas>
    </div>
  </div>
</section>

<script>
    document.getElementById('kategorija').addEventListener('change', function() {
    if (this.value === 'custom') {
      document.getElementById('custom-category').style.display = 'block';
    } else {
      document.getElementById('custom-category').style.display = 'none';
    }
  });
  
  const expensesChart = new Chart(document.getElementById('expensesChart'), {
    type: 'pie',
    data: {
      labels: JSON.parse('{{ categories|escapejs }}'),
      datasets: [{
        data: JSON.parse('{{ amounts|escapejs }}'),
        backgroundColor: ['#f39c12','#e74c3c','#3498db','#9b59b6','#2ecc71','#1abc9c','#34495e']
      }]
    }
  });

  
  const incomeExpenseChart = new Chart(document.getElementById('incomeExpenseChart'), {
    type: 'bar',
    data: {
      labels: ['Prihodi', 'Troškovi'],
      datasets: [{
        data: [
          Number("{{ monthly_data.income|default:0 }}"),
          Number("{{ total_expenses|default:0 }}")
        ],
        backgroundColor: ['#27ae60','#e74c3c']
      }]
    },
    options: {
      plugins: {legend: {display: false}},
      scales: {y: {beginAtZero:true}}
    }
  });
</script>
</body>
</html>
